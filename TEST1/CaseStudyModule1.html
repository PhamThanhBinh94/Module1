<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Demo</title>
    <!--<script src="CaseStudyModule1.js"></script>-->
</head>
<body onload="docReady();">
<canvas id="myCanvas" width="900px" height="700px" style="border:1px solid #d3d3d3;"></canvas>
    <p><input type="button" value="PLAY" onclick="start();"></p>
    <script>
        let canvas = document.getElementById("myCanvas");
        let ctx = canvas.getContext("2d");
        let Ball = function (x,y,radius,color){
            this.x = x;
            this.y = y;
            this.radius = radius;
            this.color = color;
            this.speedX = 5;
            this.speedY = 5;

            this.setBar = function (object) {
                this.barLine = object;
            }

            this.setBrick = function (object) {
                this.brickLine =object;
            }

            this.drawBall = function () {
                ctx.beginPath();
                ctx.arc(this.x, this.y,this.radius,0,2*Math.PI);
                ctx.fillStyle = color;
                ctx.fill();
            }
            this.setBall = function (x,y) {
                this.x = x;
                this.y = y;
            }
            this.moveBall = function () {
                ctx.clearRect(this.x-this.radius-5, this.y - this.radius-5, 2*this.radius+10, 2*this.radius+10)
                this.x += this.speedX;
                this.y += this.speedY;
                this.left = this.x - this.radius;
                this.right = this.x + this.radius;
                this.top = this.y - this.radius;
                this.bottom = this.y + this.radius;
                this.drawBall();
            }

            this.checkLimit = function () {
                if (this.left < 0 || this.right > canvas.width) {
                    this.speedX = -this.speedX
                }
                if (this.top < 0 ) {
                    this.speedY = -this.speedY
                }
            }

            this.checkBar = function () {
                if((this.y + this.radius == this.barLine.top || this.y -this.radius == this.barLine.top +this.barLine.height)
                    && this.x >= this.barLine.left
                    && this.x <= this.barLine.left + this.barLine.width)
                {
                    this.speedY = -this.speedY
                }
                if ((this.x + this.radius == this.barLine.left || this.x-this.radius == this.barLine.left +this.barLine.width )
                    && (this.y >= this.barLine.top
                    && this.y <= this.barLine.top + this.barLine.height)){
                    this.speedX = -this.speedX
                }
            }
            this.checkBrick = function () {
                if((this.y + this.radius == this.brickLine.top || this.y -this.radius == this.brickLine.top +this.brickLine.height)
                    && this.x >= this.brickLine.left
                    && this.x <= this.brickLine.left + this.brickLine.width)
                {
                    this.speedY = -this.speedY
                }
            }
            this.checkEndGame = function () {
                if (this.top >= canvas.height) {
                    return true
                }
            }
        }

        let Bar = function (left,top,width,height,color) {
            this.left = left;
            this.top = top;
            this.width = width;
            this.height = height;
            this.color = color;
            this.speedX = 20;
            this.moveLeft = function () {
                if (this.left > 0){
                    ctx.clearRect(this.left-1,this.top-1,this.width+2,this.height+2);
                    this.left -= this.speedX;
                    this.drawBar()}
            }
            this.moveRight = function () {
                if (this.left+this.width < canvas.width){
                    ctx.clearRect(this.left-1,this.top-1,this.width+2,this.height+2);
                    this.left += this.speedX;
                    this.drawBar()}
            }
            this.drawBar = function () {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.left, this.top, this.width, this.height);
            }
        }
        function moveSelection(evt){
            switch (evt.keyCode) {
                case 37:
                    leftArrowPressed();
                    break;
                case 39:
                    rightArrowPressed();
                    break;
            }
        }
        function leftArrowPressed() {
            bar.moveLeft()
        }
        function rightArrowPressed() {
            bar.moveRight()
        }
        function docReady(){
            window.addEventListener('keydown', moveSelection);
        }





        let Brick = function (x,y,width,height,color) {
            let _thisRef = this;
            this.left = x;
            this.top  = y;
            this.getX = function () {
                return this.left
            }
            this.getY = function () {
                return this.top
            }

            this.width = width;
            this.height = height;
            this.color = color;
            this.setBall =function (object) {
                this.ball = object
            }
            this.drawBrick = function (){
                ctx.fillStyle = this.color;
                ctx.fillRect(this.left, this.top, this.width, this.height);
            }

            this.disappear = function () {
                ctx.clearRect(this.left, this.top, this.width, this.height);
            }
            this.setStatus = function () {
                this.status = 0;
            }

            this.isTouched = function () {
                if ((((this.ball.x >= _thisRef.getX()) && (this.ball.x <= _thisRef.getX() + this.width))
                    && ((this.ball.bottom == this.top)
                        || (this.ball.top == (this.top + this.height))))
                         ||
                    (((this.ball.y >= _thisRef.getY()) && (this.ball.y <= _thisRef.getY() + this.height))
                        && ((this.ball.right == this.left)
                            || (this.ball.left == (this.left + this.width))))
                )
                {
                    return true;
                }return false;
            }
            this.breakBrick = function () {
                if (this.isTouched()) {
                    this.setStatus();
                    this.disappear();
                }
            }
        }
        let bar = new Bar (350,650,200,25,"blue");
        let ball = new Ball(450,600,10,"green")
        let brick_array =[];
        ball.setBar(bar);
        bar.drawBar();
        ball.drawBall();
        function creatBrick(x,y) {
            brick_array[brick_array.length] = new Brick(x,y,100,25,"orange");
            brick_array[brick_array.length-1].drawBrick();
            brick_array[brick_array.length-1].setBall(ball);
        }
        for (let i=0; i<5; i++) {
            for (let j = 0; j < 3; j++) {
                creatBrick(i*150 + 100, j*75 + 100)
            }
        }
        function start() {

        let gameRun = setInterval(function () {
            ball.moveBall();
            bar.drawBar();
            ball.checkLimit();
            ball.checkBar();
            if (ball.checkEndGame()) {
                alert("GAME OVER");
                clearInterval(gameRun);
            }
        },15)
        let gameWin = setInterval(function () {
            let count=0;
            for(let i=0; i<brick_array.length ;i ++){
                if (brick_array[i].status !== 0) {
                    brick_array[i].drawBrick();
                    ball.setBrick(brick_array[i]);
                    ball.checkBrick();
                    brick_array[i].breakBrick();
                }
                if (brick_array[i].status == 0) {
                    count++;
                }
               }
            if (count == brick_array.length) {
                alert('WIN');
                clearInterval(gameWin);
                clearInterval(gameRun);
            }
            },15)
        }
    </script>
</body>
</html>